<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Showcase</title>
  <!-- Google Fonts Import -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Festive&family=Hanalei&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Londrina+Shadow&family=Oswald:wght@200..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="projects.css" />
  <style>
    /* ensure profile dropdown visibility */
    .profile-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
  </style>
</head>

<body>
  <nav id="navbar">
    <ul class="navbar-items flexbox-col">
      <li class="navbar-logo flexbox-left">
        <a class="navbar-item-inner flexbox">
          <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 1438.88 1819.54">
            <polygon points="925.79 318.48 830.56 0 183.51 1384.12 510.41 1178.46 925.79 318.48" />
            <polygon
              points="1438.88 1663.28 1126.35 948.08 111.98 1586.26 0 1819.54 1020.91 1250.57 1123.78 1471.02 783.64 1663.28 1438.88 1663.28" />
          </svg>
        </a>
      </li>
      <li class="navbar-item flexbox-left">
        <a class="navbar-item-inner flexbox-left" href="index.html">
          <div class="navbar-item-inner-icon-wrapper flexbox">
            <ion-icon name="home-outline"></ion-icon>
          </div>
          <span class="link-text">Home</span>
        </a>
      </li>
      <li class="navbar-item flexbox-left">
        <a class="navbar-item-inner flexbox-left" href="projects.html">
          <div class="navbar-item-inner-icon-wrapper flexbox">
            <ion-icon name="folder-open-outline"></ion-icon>
          </div>
          <span class="link-text">Projects</span>
        </a>
      </li>
      <li class="navbar-item flexbox-left">
        <a class="navbar-item-inner flexbox-left" href="dashboard.html">
          <div class="navbar-item-inner-icon-wrapper flexbox">
            <ion-icon name="pie-chart-outline"></ion-icon>
          </div>
          <span class="link-text">Dashboard</span>
        </a>
      </li>
      <li class="navbar-item flexbox-left">
        <a class="navbar-item-inner flexbox-left">
          <div class="navbar-item-inner-icon-wrapper flexbox">
            <ion-icon name="people-outline"></ion-icon>
          </div>
          <span class="link-text">Dev's</span>
        </a>
      </li>
    </ul>
  </nav>

  <div class="page-wrapper">
    <header class="top-bar">
      <div class="header-right">
        <div class="user-profile" id="user-profile">
          <img src="https://placehold.co/40x40/cccccc/ffffff?text=L" alt="User Profile" id="profile-image" />
          <div class="profile-menu" id="profile-menu">
            <div class="profile-menu-header">
              <p id="profile-name">Loading...</p>
            </div>
            <button id="my-profile-btn">My Profile</button>
            <a href="#">Settings</a>
            <button class="logout-btn" id="logout-btn">Logout</button>
          </div>
        </div>
      </div>
    </header>
    <div class="hero">
      <h2>A Library of Ambition</h2>
      <div class="hero-box">
        <h3>where knowledge takes form</h3>
      </div>
      <div>
        <a href="#book" class="button">
          <span></span>
          <span></span>
          <span></span>
          <span></span>
          Explore</a>
      </div>
    </div>
    <div class="layer-blur"></div>
    <div class="layer-blur" id="blur2"></div>
    <div id="shelf">
      <!-- Book 1: Graphic Design -->
      <div class="book-bg graphic">
        <div class="book" id="book">
          <div id="book-shading"></div>
          <h1>Android Development</h1>
          <div class="contents">
            <div class="back-button">
              <svg viewBox="0 0 512 512" title="Close Book">
                <path
                  d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z" />
              </svg>
            </div>
            <div class="page">
              <div>
                <h1>Graphic Design</h1>
                <p class="text">
                  &emsp;Primitivism gothic art situationist international
                  neoclassicism neo-impressionism multiculturalism
                  postmodernism primitivism, postmodern art dada hyperrealism
                  existentialism neue slowenische kunst renaissance.
                </p>
              </div>
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1618004912476-29818d81ae2e?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE1NTI1MjY&ixlib=rb-1.2.1&q=80);
                  "></div>
            </div>
            <div class="page">
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1659034638032-3a0e9b7ac8d0?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE0NTUzMjM&ixlib=rb-1.2.1&q=80);
                  "></div>
              <div>
                <p class="text">
                  &emsp;Modernipsum dolor sit amet renaissance situationist
                  international metaphysical art, deformalism manierism op art
                  social realism neo-minimalism. Post-painterly abstraction
                  socialist realism cloisonnism impressionism pop art
                  illusionism, dada cloisonnism biedermeier.
                </p>
              </div>
            </div>
            <div id="page-shading"></div>
          </div>
        </div>
      </div>

      <!-- Book 2: Data Visualization -->
      <div class="book-bg data">
        <div class="book">
          <div id="book-shading"></div>
          <h1>Cloud & DevOps</h1>
          <div class="contents">
            <div class="back-button">
              <svg viewBox="0 0 512 512" title="Close Book">
                <path
                  d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z" />
              </svg>
            </div>
            <div class="page">
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1642516303080-431f6681f864?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MDU5MzU&ixlib=rb-1.2.1&q=80);
                  "></div>
              <div>
                <h1 style="margin-top: 1rem">Data Visualization</h1>
                <p class="text">
                  &emsp;Rig Veda qui dolorem ipsum quia dolor sit amet
                  vanquish the impossible shores of the cosmic ocean Rig Veda
                  venture?
                </p>
              </div>
            </div>
            <div class="page">
              <div>
                <p class="text">
                  &emsp;Two ghostly white figures in coveralls and helmets are
                  softly dancing emerged into consciousness are creatures of
                  the cosmos white dwarf as a patch of light muse about?
                  Intelligent beings the only home we've ever known
                  explorations.
                </p>
              </div>
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1584291527935-456e8e2dd734?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MDQyMTY&ixlib=rb-1.2.1&q=80);
                  "></div>
            </div>
            <div id="page-shading"></div>
          </div>
        </div>
      </div>

      <!-- Book 3: Photography -->
      <div class="book-bg photo">
        <div class="book">
          <div id="book-shading"></div>
          <h3>Desktop Application's</h3>
          <div class="contents">
            <div class="back-button">
              <svg viewBox="0 0 512 512" title="Close Book">
                <path
                  d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z" />
              </svg>
            </div>
            <div class="page is-grid">
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1659974751348-81f2acd062cc?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MzAxNTU&ixlib=rb-1.2.1&q=80);
                    grid-column: 1 / 4;
                  "></div>
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1659256955381-4e6636e3aa56?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MzAxMzI&ixlib=rb-1.2.1&q=80);
                    grid-row: 2 / 4;
                  "></div>
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1542382156909-9ae37b3f56fd?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MzA3NTU&ixlib=rb-1.2.1&q=80);
                    grid-column: 2 / 4;
                    grid-row: 2 / 4;
                  "></div>
            </div>
            <div class="page is-grid">
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1649554007580-aeba20951028?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MzA1NjU&ixlib=rb-1.2.1&q=80);
                    grid-column: 1 / 3;
                    grid-row: 1 / 3;
                  "></div>
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1661546135630-bae33b1bf310?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MzA1NjU&ixlib=rb-1.2.1&q=80);
                    grid-row: 1 / 3;
                  "></div>
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1660296444901-253891bb61c0?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MzA4Mjc&ixlib=rb-1.2.1&q=80);
                    grid-column: 1 / 3;
                  "></div>
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1660219927145-40fb8403995b?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MzAxNTU&ixlib=rb-1.2.1&q=80);
                  "></div>
            </div>
            <div id="page-shading"></div>
          </div>
        </div>
      </div>

      <!-- Book 4: Landscape Design -->
      <div class="book-bg landscape">
        <div class="book">
          <div id="book-shading"></div>
          <h1>AI/ML</h1>
          <div class="contents">
            <div class="back-button">
              <svg viewBox="0 0 512 512" title="Close Book">
                <path
                  d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z" />
              </svg>
            </div>
            <div class="page">
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1610989653808-2303456a25e6?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MDYxNzU&ixlib=rb-1.2.1&q=80);
                  "></div>
            </div>
            <div class="page">
              <div>
                <h1>Landscape Design</h1>
                <p class="text">&emsp;</p>
              </div>
            </div>
            <div id="page-shading"></div>
          </div>
        </div>
      </div>

      <!-- Book 5: Creative Writing -->
      <div class="book-bg writing">
        <div class="book">
          <div id="book-shading"></div>
          <h3>Game Development,</h3>
          <div class="contents">
            <div class="back-button">
              <svg viewBox="0 0 512 512" title="Close Book">
                <path
                  d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z" />
              </svg>
            </div>
            <div class="page">
              <div>
                <h3 style="text-align: center">Creative</h3>
                <p class="text">&emsp;</p>
                <p class="text">&emsp;</p>
              </div>
            </div>
            <div class="page">
              <div style="text-align: center">
                <h3>Writing</h3>
                <p class="text"></p>
              </div>
            </div>
            <div id="page-shading"></div>
          </div>
        </div>
      </div>

      <!-- Book 6: Web Design -->
      <div class="book-bg web">
        <div class="book">
          <div id="book-shading"></div>
          <h1>Web Development</h1>
          <h3>1.0</h3>
          <div class="contents">
            <div class="back-button">
              <svg viewBox="0 0 512 512" title="Close Book">
                <path
                  d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L142.1 239c-9.4 9.4-9.4 24.6 0 34z" />
              </svg>
            </div>
            <div class="page">
              <h1>Web Development</h1>
              <p class="text">&emsp;</p>
              <p class="text">&emsp;</p>
            </div>
            <div class="page">
              <div class="illus" style="
                    background-image: url(https://images.unsplash.com/photo-1608760000795-547e78bfc003?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NjE3MDgyMTI&ixlib=rb-1.2.1&q=80);
                  "></div>
            </div>
            <div id="page-shading"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ionicons Script for navbar icons -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <script>
    // Global variable to store projects data
    let projectsData = [];

    // Category mapping for books - updated to match backend techUsed values
    const categoryMapping = {
      web: ["web-development", "Web Development"],
      data: ["devops", "DevOps", "Cloud & DevOps"],
      landscape: ["ai-ml", "data-science", "AI/ML", "Data Science"],
      photo: ["desktop-app", "Desktop Application"],
      graphic: ["android-development", "ios-development", "Android Development", "iOS Development"],
      writing: ["game-development", "Game Development"],
    };

    // Function to fetch projects from backend
    async function fetchProjects() {
      try {
        const token = localStorage.getItem("token");
        if (!token) {
          console.error("No authentication token found");
          projectsData = [];
          return;
        }

        const response = await fetch("http://localhost:3000/api/projects/community", {
          headers: {
            "x-auth-token": token,
          },
        });

        if (response.ok) {
          projectsData = await response.json();
          console.log("Projects loaded:", projectsData);
        } else {
          console.error("Failed to fetch projects:", response.status, response.statusText);
          if (response.status === 401) {
            localStorage.removeItem("token");
            window.location.href = "login.html";
          }
          projectsData = [];
        }
      } catch (error) {
        console.error("Error fetching projects:", error);
        projectsData = [];
      }
    }

    // Function to get projects by category
    function getProjectsByCategory(bookClass) {
      const categories = categoryMapping[bookClass] || [];
      return projectsData.filter((project) => {
        // Check both techUsed and category fields for matching
        const techUsed = project.techUsed || '';
        const category = project.category || '';

        return categories.some((cat) => {
          return techUsed === cat ||
            category.toLowerCase().includes(cat.toLowerCase()) ||
            techUsed.toLowerCase().includes(cat.toLowerCase());
        });
      });
    }

    // Function to populate book content with projects
    function populateBookContent(book, projects) {
      const contentsDiv = book.querySelector(".contents");
      const backButton = contentsDiv.querySelector(".back-button");

      // Clear existing content except back button
      contentsDiv.innerHTML = "";
      contentsDiv.appendChild(backButton);

      if (projects.length === 0) {
        // Show "no projects" message
        const noProjectsPage = document.createElement("div");
        noProjectsPage.className = "page";
        noProjectsPage.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h2 style="color: #666; margin-bottom: 1rem;">No Projects Found</h2>
                        <p style="color: #888;">No projects available in this category yet.</p>
                        <p style="color: #888; margin-top: 1rem;">Create your first project to get started!</p>
                    </div>
                `;
        contentsDiv.appendChild(noProjectsPage);
      } else {
        // Create pages for each project
        projects.forEach((project, index) => {
          const page = document.createElement("div");
          page.className = "page project-page";
          page.style.cursor = "pointer";
          page.dataset.projectId = project._id;

          const createdDate = new Date(project.createdAt).toLocaleDateString();
          const projectTitle = project.projectName || project.title || 'Untitled Project';
          const projectDesc = project.projectDescription || project.description || 'No description available';
          const authorName = project.user ? (project.user.name || project.user.email || 'Anonymous') : 'Anonymous';
          const projectImage = project.screenshotUrl ? `http://localhost:3000${project.screenshotUrl}` : null;

          page.innerHTML = `
                        <div style="height: 100%; display: flex; flex-direction: column;">
                            ${projectImage ? `
                                <div style="flex: 0 0 40%; margin-bottom: 1rem; border-radius: 8px; overflow: hidden;">
                                    <img src="${projectImage}" alt="${projectTitle}" style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                            ` : ''}
                            <div style="flex: 1; display: flex; flex-direction: column;">
                                <h2 style="margin-bottom: 1rem; color: #333; font-size: 1.2rem;">${projectTitle}</h2>
                                <p class="text" style="margin-bottom: 1rem; flex: 1; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">${projectDesc}</p>
                                <div style="margin-top: auto;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #eee;">
                                        <div>
                                            <div style="color: #666; font-size: 0.8rem;">By: ${authorName}</div>
                                            <div style="color: #666; font-size: 0.8rem;">Created: ${createdDate}</div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span style="color: #666; font-size: 0.9rem;">👍 ${project.upvotes || 0}</span>
                                            <span style="background: #e3f2fd; color: #1976d2; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">${project.category || 'General'}</span>
                                        </div>
                                    </div>
                                    <div style="margin-top: 0.5rem; text-align: center;">
                                        <small style="color: #999; font-style: italic;">Click to view full details</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

          // Add click event listener to show full project details
          page.addEventListener('click', (e) => {
            e.stopPropagation();
            showProjectDetails(project);
          });

          contentsDiv.appendChild(page);
        });
      }

      // Add page shading
      const pageShading = document.createElement("div");
      pageShading.id = "page-shading";
      contentsDiv.appendChild(pageShading);
    }

    // Function to show full project details in a modal or overlay
    function showProjectDetails(project) {
      const projectTitle = project.projectName || project.title || 'Untitled Project';
      const projectDesc = project.projectDescription || project.description || 'No description available';
      const authorName = project.user ? (project.user.name || project.user.email || 'Anonymous') : 'Anonymous';
      const createdDate = new Date(project.createdAt).toLocaleDateString();
      const projectImage = project.screenshotUrl ? `http://localhost:3000${project.screenshotUrl}` : null;

      // Create modal overlay
      const modal = document.createElement('div');
      modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.8);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
          padding: 2rem;
        `;

      modal.innerHTML = `
          <div style="
            background: white;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
          ">
            <button style="
              position: absolute;
              top: 1rem;
              right: 1rem;
              background: #f5f5f5;
              border: none;
              border-radius: 50%;
              width: 40px;
              height: 40px;
              cursor: pointer;
              font-size: 1.2rem;
              z-index: 1;
            " onclick="this.closest('.modal-overlay').remove()">×</button>
            
            ${projectImage ? `
              <div style="height: 250px; overflow: hidden; border-radius: 12px 12px 0 0;">
                <img src="${projectImage}" alt="${projectTitle}" style="width: 100%; height: 100%; object-fit: cover;">
              </div>
            ` : ''}
            
            <div style="padding: 2rem;">
              <h1 style="margin-bottom: 1rem; color: #333;">${projectTitle}</h1>
              <p style="color: #666; margin-bottom: 2rem; line-height: 1.6;">${projectDesc}</p>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                <div>
                  <strong style="color: #333;">Author:</strong><br>
                  <span style="color: #666;">${authorName}</span>
                </div>
                <div>
                  <strong style="color: #333;">Created:</strong><br>
                  <span style="color: #666;">${createdDate}</span>
                </div>
                <div>
                  <strong style="color: #333;">Category:</strong><br>
                  <span style="background: #e3f2fd; color: #1976d2; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.9rem;">${project.category || 'General'}</span>
                </div>
                <div>
                  <strong style="color: #333;">Upvotes:</strong><br>
                  <span style="color: #666;">👍 ${project.upvotes || 0}</span>
                </div>
              </div>
              
              ${project.projectUrl || project.githubUrl ? `
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                  ${project.projectUrl ? `
                    <a href="${project.projectUrl}" target="_blank" style="
                      background: #1976d2;
                      color: white;
                      padding: 0.75rem 1.5rem;
                      border-radius: 8px;
                      text-decoration: none;
                      font-weight: 500;
                    ">View Project</a>
                  ` : ''}
                  ${project.githubUrl ? `
                    <a href="${project.githubUrl}" target="_blank" style="
                      background: #333;
                      color: white;
                      padding: 0.75rem 1.5rem;
                      border-radius: 8px;
                      text-decoration: none;
                      font-weight: 500;
                    ">View Code</a>
                  ` : ''}
                </div>
              ` : ''}
            </div>
          </div>
        `;

      modal.className = 'modal-overlay';
      document.body.appendChild(modal);

      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    // When any book is clicked, open it and populate with projects
    document.querySelectorAll(".book-bg").forEach(function (book) {
      book.addEventListener("click", function () {
        // First, check if the clicked book is already active. If so, do nothing.
        if (this.classList.contains("active")) {
          return;
        }

        // Close any other book that might be open
        document
          .querySelectorAll(".book-bg.active")
          .forEach(function (openBook) {
            openBook.classList.remove("active");
          });

        // Get the book category class
        const bookClasses = Array.from(this.classList);
        const categoryClass = bookClasses.find((cls) =>
          [
            "web",
            "data",
            "landscape",
            "photo",
            "graphic",
            "writing",
          ].includes(cls)
        );

        if (categoryClass) {
          // Get projects for this category
          const categoryProjects = getProjectsByCategory(categoryClass);

          // Populate the book with project data
          populateBookContent(this, categoryProjects);
        }

        // Then, open the clicked book
        this.classList.add("active");
      });
    });

    // When any back button is clicked, close its parent book.
    document.addEventListener("click", function (event) {
      if (event.target.closest(".back-button")) {
        event.stopPropagation();
        const backButton = event.target.closest(".back-button");
        backButton.closest(".book-bg").classList.remove("active");
      }
    });

    // User Profile Management
    async function loadUserProfile() {
      try {
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "login.html";
          return;
        }

        const response = await fetch("/api/users/me", {
          headers: {
            "x-auth-token": token,
          },
        });

        if (response.ok) {
          const user = await response.json();
          document.getElementById("profile-name").textContent =
            user.name || user.email || "User";

          // Handle profile picture
          if (user.profilePictureUrl) {
            const imageUrl = user.profilePictureUrl.startsWith("http")
              ? user.profilePictureUrl
              : `${window.location.origin}${user.profilePictureUrl}`;
            document.getElementById("profile-image").src = imageUrl;
          } else {
            // Generate placeholder with user's initial
            const initial = (user.name || user.email || "U")
              .charAt(0)
              .toUpperCase();
            document.getElementById(
              "profile-image"
            ).src = `https://placehold.co/40x40/1877f2/ffffff?text=${initial}`;
          }
        } else {
          console.error("Failed to load user profile");
          if (response.status === 401) {
            localStorage.removeItem("token");
            window.location.href = "login.html";
          }
        }
      } catch (error) {
        console.error("Error loading user profile:", error);
        localStorage.removeItem("token");
        window.location.href = "login.html";
      }
    }

    // Logout functionality
    document.getElementById("logout-btn").addEventListener("click", () => {
      localStorage.removeItem("token");
      window.location.href = "login.html";
    });

    // My Profile button functionality
    document
      .getElementById("my-profile-btn")
      .addEventListener("click", () => {
        // You can implement profile modal or redirect to profile page
        console.log("My Profile clicked");
      });

    // Profile menu dropdown logic
    const userProfileEl = document.getElementById("user-profile");
    const profileMenuEl = document.getElementById("profile-menu");
    userProfileEl.addEventListener("click", (e) => {
      e.stopPropagation();
      profileMenuEl.classList.toggle("show");
    });
    window.addEventListener("click", () => {
      if (profileMenuEl.classList.contains("show")) {
        profileMenuEl.classList.remove("show");
      }
    });

    // Load user profile and projects on page load
    window.addEventListener("load", async () => {
      await loadUserProfile();
      await fetchProjects();
    });
  </script>
</body>

</html>